<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html lang="en"> <head>
<title>MeetMe!</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" type="text/css"
     href="//cdn.jsdelivr.net/bootstrap/latest/css/bootstrap.css"/>

<link rel="stylesheet" type="text/css"
    href="/static/css/busy.css"/>

<!-- jquery from a content distribution network; probably cached -->
<script type="text/javascript"
     src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
</script>

<!-- Moment and a date range picker -->
<script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>

<script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />
</head>

<body>
<div class="container">

    <br />

    <h1>Create a new meeting</h1>
    <br />
    <label>List everyone that will be attending, including you:</label>

    <table class="invite_table" id="invite_table">
    <tr class="invitee">
      <td><input name="name" id="p_0" type="text" size="15" /></td>
      <td><input type="submit" value="Add" onclick="add_invitee()"></td>
    </tr>
  </table>

    <br />
    <input type="submit" value="Create meeting!" onclick="goto_join_page()">


    <br />


<script type="text/javascript">

  var SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
  var NEXT_URL = SCRIPT_ROOT + "/_get_names";


    function add_invitee(){
    // Add additional invitee to the invitee table.
    console.log("Adding another invitee.");
    var table = document.getElementById('invite_table');
    var id_no = table .rows.length;
    table.insertRow().outerHTML = "<tr class='invitee'>" +
            "<td><input name='name' id='p_"+ id_no +"' type='text' size='15'/></td>" +
            "<td><input type='submit' value='Add' onclick='add_invitee()'></td></tr>";
  }


  function goto_join_page(){
    // Get all the names, pass them over to the server,
    // then redirect to the join page for the meeting that we just created.
    console.log("Preparing to redirect to join page for the new meeting.");
    var table = document.getElementById('invite_table');
    var participants = [];
    var tab_len = table.rows.length;
    for (var i = 0; i < tab_len; i++){
        var cur_person = document.getElementById("p_" + i).value;
        if (cur_person != ""){
            participants.push(cur_person)
        }
    }
    console.log("Got the following participants: ", participants);
    if (participants.length >= 1){
        // Don't want to do actually go to the next page if list is empty.
        $.getJSON(NEXT_URL, {participants: JSON.stringify(participants)}, function(data){
             var meet_code = data.result.meetcode;
             console.log("Routing to meet code:", meet_code);
             window.location.assign(SCRIPT_ROOT + meet_code + "/join");
        });
    }
  }


  $(document).ready(function(){onPageLoad();});

  function onPageLoad(){
  }

</script>
</div>
</body>
</html>
